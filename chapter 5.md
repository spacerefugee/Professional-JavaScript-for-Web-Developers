### 第5章 引用类型

#### 5.1 Object类型
- 创建Object实例的方式有两种。第一种是使用new操作符后跟Object构造函数。另一种方式是使用对象字面量表示法。对象字面量是对象定义的一种简写方式，目的在于简化创建包含大量属性的对象的过程。对象字面量由一对包含属性的花括号表示，多个属性之间以逗号隔开。

#### 5.2 Array类型
- 创建数组的基本方式有两种。第一种是使用Array构造函数，第二种方式是使用数组字面量表示。数组字面量由一对包含数组项的方括号表示，多个数组项之间以逗号隔开。

##### 5.2.1 检测数组
- 使用Array.isArray()方法，可以确定某个值是不是数组，而不管它是在哪个全局执行环境中创建的。

##### 5.2.2 转换方法
- 使用toString()或者valueOf()可以返回数组的字符串表示；toLocaleString()方法经常也会返回与toString()和valueOf()方法相同的值；使用join()方法可以使用不同的分隔符来构建这个字符串。

##### 5.2.3 栈方法
- ECMAScript为数组专门提供了push()和pop()方法，以便实现类似栈的行为。
- push()方法可以接收任意数量的参数，把它们逐个添加到数组末尾，并返回改后数组的长度。而pop()方法则从数组末尾移除最后一项，减少数组的值，然后返回移除的项。

##### 5.2.4 列队方法
- shift()方法能够移除数组中的第一个项并且返回该项，同时将数组长度减1。结合使用shift()和push()方法，可以像使用队列一样使用数组。
- ECMAScript还为数组提供了一个unshift()方法。使用unshift()和Pop()方法，可以从相反的方向来模拟列队，即在数组的前端添加项，从数组末端移除项。

##### 5.2.5 重排序方法
- reverse()和sort()两个方法可以实现重排序。reverse()会反转数组项的顺序。
- 在默认情况下sort()方法按圣墟排列数组项，比较的是字符串。可以传入比较函数指定哪个值位于哪个值的前面。

##### 5.2.6 操作方法
- concat()方法可以给予当前数组中的所有项创建一个新数组。
- slice()方法能够基于当前数组中的一或多个项创建一个新数组。接收要返回项的起始和结束为止。
- splice()方法又很多种用法，主要用途是向数组的中部插入项，规则如下：
  - **删除**：可以删除任意数量的项，只需要指定2个参数：要删除的第一项的位置和要删除的项数。例如，splice(0,2)会删除数组中的前两项。
  - **插入**：可以向指定位置插入任意数量的项，只需要提供3个参数：起始位置、0（要删除的项数）和要插入的项。如果要插入多个项，可以再传入第四、第五，以至任意多个项。例如，splice(2,0,"red","green")会从当前数组的位置2开始插入字符串"red"和"green"。
  - **替换**：可以向指定位置插入任意数量的项，并且同时删除任意数量的项，只需指定3个参数：起始位置、要删除的项数和要插入的任意数量的项。插入的项数不必与删除的项数相等。例如splice(2,1,"red","green")会删除当前数组的位置2的项，然后再从位置2开始插入字符串"red"和"green"。

##### 5.2.7 位置方法
- ECMAScript5为数组实例添加了两个位置方法：indexOf()和lastIndexOf()。这两个方法都接收两个参数：要查找的项和（可选的）表示查找起点位置的索引。其中，indexOf()方法从数组的开头（位置0）开始向后查找，lastIndexOf()方法则从数组的末尾开始向前查找。这两个方法都返回要查找的项子数组中的位置，或者在没有找到的情况下返回-1。在比较参数与数组中的每一项时，使用的是全等操作符。

##### 5.2.8 迭代方法
- ECMAScript5为数组定义了5个迭代方法：
  - every()：对数组中的每一项运行给定函数，如果该函数对每一项都返回true，则返回true。
  - filter()：对数组中的每一项运行给定函数，返回该函数会返回true的项组成的数组。
  - forEach()：对数组中的每一项运行给定函数。这个方法没有返回值。
  - map()：对数组中的每一项运行给定函数，返回每次函数调用的结果组成的数组。
  - some()：对数组中的每一项运行给定函数，如果该函数对任一项返回true，则返回true。

##### 5.2.9 缩小方法
- ECMAScript5有两个缩小数组的方法：reduce()和reduceRight()。这两个方法都会迭代数组的所有项，然后构建一个最终返回的值。其中，reduce()方法从数组的第一项开始，逐个遍历到最后，而reduceRight()则从数组的最后一项开始，向前遍历到第一项。

#### 5.3 Date类型
- 要创建一个日期对象，使用new操作符和Date构造函数即可。

```javascript
var now = new Date();
```
- Date.parse()方法接收一个表示日期的字符串参数，然后尝试根据这个字符串返回相应日期的毫秒数。如果传入的字符串不能表示日期，则返回NaN。
- Date.UTC()方法同样也返回表示日期的毫秒数。参数分别是年份、基于0的月份（一月是0，二月是1，以此类推）、月中的哪一天（1到31）、小时数（0到23）、分钟、秒以及毫秒数。前两个参数（年和月）为必填，其他默认为0。
- Date的构造函数接收的参数仍然和Date.UTC()相同，但是日期和时间都是基于本地时区而非GMT来创建。
- Date.now()方法可以返回调用这个方法时的日期和时间的毫秒数。

##### 5.3.1 继承的方法
- Date类重写了toLocaleString()、toString()和valueOf()方法。toLocaleString()方法会按照与浏览器设置的地区相适应的格式返回日期和时间。toString()返回带有时区信息的日期和时间。valueOf()返回日期的毫秒表示，可以用于比较大小。

##### 5.3.2 日期格式化
- Date类型还有一些专门用于将日期格式化为字符串的方法，这些方法如下。
  - toDateString()——以特定于实现的格式显示星期几、月、日和年；
  - toTimeString()——以特定于实现的格式显示时、分、和时区；
  - toLocaleDateString()——以特定于地区的格式显示星期几、月、日和年；
  - toLocaleTimeString()——以特定于实现的格式显示时、分、秒；
  - toUTCString()——以特定于实现的格式完整的UTC日期。
- 与toLocaleString()和toString()方法一样，以上这些字符串格式方法的输出也是因浏览器而异的，因此没有哪一个方法能够用来在用户界面中显示一致的日期信息。

##### 5.3.3 日期/时间组件方法

#### 5.4 RegExp类型
- 使用类似Perl的语法创建一个正则表达式：

```
var expression = / pattern / flags ;
```
- 其中的模式(pattern)部分可以说hi任何简单或复杂的正则表达式，可以包含字符类，限定类，分组，向前查找以及反向引用。每个正则表达式都可以带有一个或多个标志(flags)，用以标明正则表达式的行为。正则表达式的匹配模式支持下列3个标志：
  - **g**：表示全局(global)模式，即模式将被应用于所有字符串，而非在发现第一个匹配项时立即停止；
  - **i**：表示不区分大小写(case-insensitive)模式，即在确定匹配项时忽略模式与字符串的大小写；
  - **m**：表示多行(multiline)模式，即在到达一行文本末尾时还会继续查找下一行中是否存在与模式匹配的项。

##### 5.4.1 RegExp实例属性
- RegExp的每个实例都具有下列属性，通过这些属性可以取得有关模式的各种信息：
  - global：布尔值，表示是否设置了g标志。
  - ignoreCase：布尔值，表示是否设置了i标志。
  - lastIndex：整数，表示开始搜索下一个匹配项的字符位置，从0算起。
  - multiline：布尔值，表示是否设置了m标志。
  - source：正则表达式的字符串表示，按照字面量形式而非传入构造函数中的字符串模式返回。

##### 5.4.2 RegExp实例方法
- RegExp对象的主要方法是exec()，exec()接受一个参数，即信息要应用模式的字符串，然后返回包含第一个匹配信息的数组，或者在没有匹配项的情况下返回null。
- 正则表达式的第二个方法是test()，test()接受一个字符串参数，在模式与该参数匹配的情况下返回true；
- RegExp实例继承的toLocaleString()和toString()方法都会返回正则表达式的字面量。

##### 5.4.3 RegExp构造函数属性

##### 5.4.4 模式的局限性
- ECMAScript正则表达式不支持的特性：
  - 匹配字符串开始和结尾的\A和\Z锚
  - 向后查找(lookbehind)
  - 并集和交集类
  - 原子组(atomic grouping)
  - Unicode支持（单个字符除外，如\uFFFF）
  - 命名的捕获组
  - s(single，单行)和x(free-spacing，无间隔)匹配模式
  - 条件匹配
  - 正则表达式注释

#### 5.5 Function类型
- 函数实际上是对象，每个函数都是Function类型的实例，而且都与其他引用类型一样具有属性和方法。由于函数是对象，因此函数名实际上也是一个指向函数对象的指针，不会与某个函数绑定。

##### 5.5.1 没有重载
- ECMAScript中没有函数重载的概念。

##### 5.5.2 函数声明与函数表达式
- 解析器会先读取函数声明，并使其在执行任何代码之前就可用；而函数表达式则必须等到解析器执行到它所在的代码行，才会真正被解释执行。

##### 5.5.3 作为值的函数
- 不仅可以像传递参数一样把一个函数传递给另一个函数，而且可以将一个函数作为另一个函数的结果返回。

##### 5.5.4 函数内部属性
- 函数内部有两个特殊对象：arguments和this。
- arguments还有一个callee的属性，该属性是一个指针，指向拥有这个arguments对象的函数。
- this行为与Java和C#中的this大致类似，this引用的是函数执行的环境对象——或者也可以说是this值。当在网页的全局作用域中调用函数时，this对象引用的就是window。
- caller这个属性中保存着调用当前函数的函数的引用。如果是在全局作用域中调用当前函数，它的值为null。为了实现更松散的耦合，可以通过arguments.callee.caller来访问相同的信息。
- 当函数在严格模式下运行时，arguments.caller会导致错误。

##### 5.5.5 函数属性和方法
- 函数也有属性和方法，每个函数都包含两个属性：length和prototype。
- length属性表示函数希望接收的命名参数的个数。
- prototype保存所有实例方法的真正所在。诸如toString()和valueOf()等方法实际上都保存在prototype名下，只不过是通过各自对象的实例访问罢了。
- 每个函数都包含两个非继承而来的方法：apply()和call()。这两个方法的用途都是在特定的作用域中调用函数，实际上等于设置函数体内的this对象值。
- apply()方法接收两个参数：一个是在其中运行函数的作用域，另一个是参数数组。
- call()方法与apply()方法的作用相同，它们的区别仅在于接收参数的方式不同。在使用call()方法时，传递给函数的参数必须逐个列举出来。
- apply()和call()真正强大的地方是能够扩充函数赖以运行的作用域。使用call()或apply()来扩充作用域的最大好处，就是对象不需要与方法又任何耦合关系。
- bind()方法会创建一个函数的实例，其this值会被绑定到传给bind()函数的值。

#### 5.6 基本包装类型
- ECMAScript提供了3个特殊的引用类型：Boolean、Number和String。

##### 5.6.1 Boolean类型
- 基本类型与引用类型的布尔值有区别，很容易造成误解，建议尽量不要使用Boolean对象。

##### 5.6.2 Number类型
- toFixed()会按照指定的小数位返回数值的字符串表示。如果数值本身包含的小数位比指定的还多，那么接近指定的最大小数位的值就会舍入。
- toExponential()方法返回以指数表示法（也称e表示法）表示的数值的字符串形式。
- toPrecision()方法返回某个数值的最适合格式。

##### 5.6.3 String类型
- length属性返回字符串的长度。

###### 1. 字符方法
- charAt()，接收基于0的字符位置，返回该位置的字符。
- charCodeAt()，接收基于0的字符位置，返回该位置字符的字符编码。
- 在会吃的浏览器中，可以使用方括号加数字索引来访问字符串中的特定字符。

###### 2. 字符串操作方法
- concat()，用于将一或多个字符串拼接起来，返回拼接得到的新字符串。
- slice(),substr(),substring()

###### 3. 字符串位置方法
- indexOf()从开头向后搜索字符串。
- lastIndexOf()从字符串末尾向前搜索字符串。
- 上述两个方法第二个参数可以指定开始搜索的位置。

###### 4. trim()方法
- 该方法删除字符串前置及后缀的所有空格。

###### 5. 字符串大小写转换方法
- toLowerCase()转换成小写
- toLocaleLowerCase()针对特定地区实现的转换小写
- toUpperCase()转换成大写
- toLocaleUpperCase()针对特定地区实现的转换大写

###### 6. 字符串的模式匹配方法
- match()这个方法本质上与调用RegExp的exec()方法相同，该方法只接收一个参数，正则表达式或者一个RegExp对象。返回数组。
- search()接收参数和match一样，但返回的是索引。没有匹配项则返回-1。
- replace()方法可以进行替换字符串操作，接收两个参数：第一个参数可以是一个RegExp对象或者一个字符串（这个字符串不会被转换成正则表达式），第二个参数可以是一个字符串或者一个函数。

###### 7. localeCompare()方法
- 这个方法比较两个字符串并返回下列值中的一个：
  - 如果字符串在字母表中应该排在字符串参数之前，则返回一个负数（大多数情况下是-1，具体的值要视实现而定）；
  - 如果字符串等于字符串参数，则返回0；
  - 如果字符串在字母表中应该排在字符串参数之后，则返回一个正数（大多数情况下是1，具体的值同样要视实现而定）。

###### 8. fromCharCode()方法
- 这个方法的任务是接收一或多个字符编码，然后将他们转换成一个字符串。
- 从本质上来看，这个方法与实例方法charCodeAt()执行的是相反的操作。

###### 9. HTML方法
- 尽量不要使用这些方法。

#### 5.7单体内置对象
- 由ECMAScript实现提供的、不依赖于宿主环境对象，这些对象在ECMAScript程序执行之前就已经存在了。例如Object、Array和String还有Global和Math。

##### 5.7.1 Global对象
- Golbal对象不属于任何其他对象的属性和方法，最终都是它的属性和方法。所有在全局作用域中定义的属性和函数，都是Gobal对象的属性

###### 1. URI编码方法
- encodeURI()和encodeRUIComponent()方法可以对URI(Uniform Resource Identifiers，同源资源标识符)进行编码。用特殊的UTF-8编码替换所有无效的字符，从而让浏览器能够接受和理解。
- encodeURI()主要用于整个URI，而encodeURIComponent()主要用于对URI中某一段进行编码。
- decodeURI和decodeURIcomponent()可以分别对encodeURI()和encodeURIComponent()方法替换的字符进行解码。

###### 2. eval()方法
- eval()方法就像是一个完整的ECMAScript解析器，它只接受一个参数，即要执行的ECMAScript(或JavaScript)字符串。
- 能够解释代码字符串的能力非常强大，但也非常危险。因此在使用eval()时必须极为谨慎，特别是在用它执行用户输入的数据的情况下。否则，可能会有恶意用户输入威胁你的站点或应用程序安全的代码（即所谓的代码注入）。

###### 3. Global对象的属性
- Global对象还包含一些属性，其中一部分属性已经在本书前面介绍过了。例如，特殊的值undefined、NaN以及Infinity都是Global对象的属性。此外，所有原生引用类型的构造函数，像Object和Function也都是Global对象的属性。下表列出了Global对象的所有属性。

属性 | 说明 | 属性 | 说明
---|---|---|---
undefined | 特殊值undefined | Date | 构造函数Date
NaN | 特殊值NaN | RegExp | 构造函数RegExp
Infinity | 特殊值Infinity | Error | 构造函数Error
Object | 构造函数Object | EvalError | 构造函数EvalError
Array | 构造函数Array | RangeError | 构造函数RangeError
Function | 构造函数Function | ReferenceError | 构造函数ReferenceError
Boolean | 构造函数Boolean | SyntaxError | 构造函数SyntaxError
String | 构造函数String | TypeError | 构造函数TypeError
Number | 构造函数Number | URIError | 构造函数URIError

###### 4. window对象
- ECMAScript虽然没有指出如何直接访问Global对象，但Web浏览器都是将这个全局对象作为window对象的一部分加以实现的。因此，在全局作用域中声明的所有变量和函数，就都成为了window对象的属性。

##### 5.7.2 Math对象
- ECMAScript还为保存数学公式和信息提供了一个公共位置，即Math对象。与我们在JavaScript直接编写的计算功能相比，Math对象提供的计算功能执行起来要快得多。Math对象中还提供了辅助完成这些计算的属性和方法。

###### 1. Math对象的属性
- Math对象包含的属性大都是数学计算中可能会用到的一些特殊值。下表列出了这些属性。
属性 | 说明
--- | ---
Math.E | 自然对数的底数，即常量e的值
Math.LN10 | 10的自然对数
Math.LN2 | 2的自然对数
Math.LOG2E | 以2为底e的对数
Math.LOG10E | 以10为底e的对数
Math.PI | π的值
Math.SQRT1_2 | 1/2的平方根（即2的平方根的倒数）
Math.SQRT2 | 2的平方根

###### 2. min()和max()方法
- min()和max()方法用于确定一组数值中的最小值和最大值。这两个方法都可以接受任意多个数值参数。

###### 3. 舍入方法
- 将小数舍入为整数有几个方法：Math.ceil()、Math.floor()和Math.round()。
- Math.ceil()执行向上舍入，即它总是将数值向上舍入为最接近的整数；
- Math.floor()执行向下舍入，即它总是将数值向下舍入为最接近的整数；
- Math.round()执行标谁舍入，即它总是将数值四舍五入为最接近的整数（这也是我们在数学课上学到的舍入规则）。

###### 4. random()方法
- Math.random()方法返回一个介于0和1之间的随机数，不包括0和1。
- 套用下面的公式，就可以利用Math.random()从某个整数范围内随机选择一个值。

```
 值 = Math.floor(Math.random() * 可能值的总数 + 第一个可能的值)
```

###### 5. 其他方法
方法 | 说明 | 方法 | 说明
---|---|---|---
Math.abs(num) | 返回num的绝对值 | Math.asin(x) | 返回x的反正弦值
Math.exp(num) | 返回Math.E的num次幂 | Math.atan(x) | 返回x的反正切值
Math.log(num) | 返回num的自然对数 | Math.atan2(y,x) | 返回y/x的反正切值
Math.pow(num,power) | 返回num的power次幂 | Math.cos(x) | 返回x的余弦值
Math.sqrt(num) | 返回num的平方根 | Math.sin(x) | 返回x的正弦值
Math.acon(num) | 返回x的反余弦值 | Math.tan(x) | 返回x的正切值
